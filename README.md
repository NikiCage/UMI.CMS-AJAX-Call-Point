# UMI.CMS AJAX Call Point
Идея в том, что построение сайта не меняется. Блоки делятся на два типа динамические и композитные.

**Динамические блоки** генерируются вместе со станицей и меняются реагируя на клиентские события. Это может быть фильтруемый каталог или подгружаемые новости.

**Композитные блоки** - это части сайта, которые не загружаются вместе со страницей, но могут быть загружены в ответ на клиентские события. Например: любой контент для модального окна или реализация lazy load для неиндексируемых частей сайта.

Подразумевается, что блок соответствует макросу (который может менять данные в зависимости от GET-параметров) и шаблону блока.

Стандартный вызов блока на PHP-шаблонизаторе выглядит так:

`<?=$this->render($this->macros('module', 'method', $params), '/*Путь до шаблона*/')?>`

Чтобы сделать блок динамичным, эта конструкция меняется на

`<?=$this->macros('custom','/*Путь до шаблона*/',array('module','method', $params, false))?>`

После этой замены в переменной шаблона $variables добавится поле 'callPoint'. Это строка с id блока. Ее можно вставить в любое удобное место, например в атрибут data-callpoint  

` data-callpoint="<?=$variables['callPoint']?>" `

Остальное дело JavaScript. Подтягиваем значение с id блока из DOM и AJAX-запросом вида /udata/custom/call_point/id с параметрами получаем измененный блок.

Для композитного блока актуально все, что написанно выше. Разница лишь в том, что при вызове в композитном режиме макрос не выполняется, а просто регистрирует блок.

` data-callpoint="<?=$this->macros('custom','/*Путь до шаблона*/',array('module','method', $params, true))?>" `